# SCMV Fuel Report

Веб-приложение для анализа расхода топлива и событий (заправки/сливы) на основе данных GPS-трекинга.

## Возможности

- **Подключение по WebSocket**: Работает в реальном времени с сервером `scmv.vpngps.com`.
- **Визуализация**:
  - Интерактивная карта (Leaflet) с отображением трека и событий.
  - График уровня топлива (Chart.js) с возможностью масштабирования.
- **Аналитика**:
  - Автоматическое определение заправок и сливов.
  - Умная фильтрация "медленных" заправок и колебаний топлива.
  - Расчет общего пробега, расхода и среднего расхода на 100 км.
- **Настройки**:
  - Настраиваемые пороги для определения заправок и сливов.
  - Фильтрация нулевых значений.
  - Логика "Зажигания" (игнорирование сливов на высокой скорости).

## Установка и Запуск

# SCMV Fuel Report

Веб-приложение для анализа расхода топлива и мониторинга показаний датчиков (температура/влажность) на основе данных GPS-трекинга.

Основные особенности
- Подключение к серверу по WebSocket (конфиг в `js/config.js`).
- Интерактивная карта (Leaflet) с треком, указанием разрывов и маркерами событий (заправки/сливы).
- Графики (Chart.js): уровень топлива, температура, влажность; масштабирование и панорамирование.
- Аналитика топлива: выявление заправок/сливов, подсчет расхода, пробега и моточасов.
- Аналитика датчиков: общая и суточная сводки по температуре/влажности, подсчет времени вне границ (по настройкам).
- Настройки анализа (пороги) сохраняются отдельно для каждого пользователя в `localStorage`.

Быстрый старт
1. Клонируйте репозиторий:

```powershell
git clone https://github.com/OdenUA/SCMV-Fuel-Report.git
```

2. Откройте `index.html` в браузере (приложение работает как статическая страница).

Примечание: для работы WebSocket используйте корректную конфигурацию в `js/config.js`.

Пользовательские настройки
- Пороги детекции заправок/сливов, фильтра нулей, логика движения и границы температуры/влажности находятся в панели "Настройки анализа".
- Настройки автоматически сохраняются в `localStorage` под ключом `dt_settings_<username>` после входа пользователя.

Как использовать
1. Введите логин/пароль и нажмите "Подключиться".
2. Выберите устройство или введите ID устройства.
3. Установите диапазон дат и нажмите "Загрузить отчет".
4. После загрузки данных интерфейс автоматически переключится:
   - при наличии данных топлива — отображаются график, карта, таблицы и сводки по бакам;
   - при наличии только данных датчиков — отображается график и сводки по температуре/влажности (карта скрывается).

Структура проекта
- `index.html` — основной HTML.
- `css/style.css` — стили.
- `js/` — основная логика приложения:
  - `config.js` — конфигурация (WebSocket URL и пр.).
  - `state.js` — глобальное состояние.
  - `api.js` — WebSocket и обмен сообщениями.
  - `analytics.js` — обработка и агрегация данных (топливо и датчики).
  - `chart.js` — инициализация и рендер графиков.
  - `map.js` — инициализация карты и отрисовка трека/событий.
  - `ui.js` — управление DOM, таблицами и сохранением настроек.
  - `utils.js` — утилиты (форматирование дат/времени).
  - `main.js` — загрузка/инициализация приложения.

Разработка
- Приложение написано на Vanilla JS (ES6) и не требует сборки — откройте `index.html` в браузере.
- Для локальной отладки можно использовать статический сервер, например:

```powershell
# Windows PowerShell
python -m http.server 8000
# или, если установлен http-server (npm)
npx http-server -p 8000
```

Где смотреть настройки
- Пороги и прочие настройки находятся в панели "Настройки анализа" в UI и также сохраняются в `localStorage`.

Контакт
- Репозиторий: https://github.com/OdenUA/SCMV-Fuel-Report

Если нужно — добавлю раздел с описанием API сообщений WebSocket и примером ответов сервера.
