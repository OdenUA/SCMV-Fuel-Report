<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fuel Analytics App</title>
    
    <!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    
    <!-- Date handling (Date-fns bundle) -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ru.js"></script>

    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="sidebar">
    <h2>‚õΩ Fuel Analytics</h2>
    
    <!-- Auth -->
    <div class="control-group">
        <label>–õ–æ–≥–∏–Ω</label>
        <input type="text" id="loginUser" placeholder="username">
    </div>
    <div class="control-group">
        <label>–ü–∞—Ä–æ–ª—å</label>
        <input type="password" id="loginPassword" placeholder="password">
    </div>
    <div class="control-group" style="flex-direction: row; align-items: center; gap: 10px; margin-bottom: 10px;">
        <input type="checkbox" id="rememberMe" style="width: auto; margin: 0;">
        <label for="rememberMe" style="margin: 0; font-weight: normal; cursor: pointer;">–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è</label>
    </div>
    <button id="connectBtn" class="btn">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
    <div id="connectionStatus" class="status-indicator status-disconnected">–û—Ç–∫–ª—é—á–µ–Ω–æ</div>
    
    <hr style="width: 100%; border: 0; border-top: 1px solid #eee; margin: 20px 0;">
    
    <!-- Controls -->
    <div class="control-group">
        <label>ID –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</label>
        <div class="input-with-btn">
            <input type="number" id="deviceId" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1699">
            <button id="toggleVehicleBtn" class="btn btn-secondary" type="button" style="width: auto; padding: 0 10px;">–í—ã–±—Ä–∞—Ç—å</button>
        </div>
    </div>
    
    <div class="control-group">
        <label>–î–∞—Ç–∞ —Å</label>
        <div class="input-with-btn">
            <input type="text" id="dateFrom">
            <button type="button" id="btnDateFrom" class="btn btn-secondary" style="padding: 0 10px;">üìÖ</button>
        </div>
    </div>
    
    <div class="control-group">
        <label>–î–∞—Ç–∞ –ø–æ</label>
        <div class="input-with-btn">
            <input type="text" id="dateTo">
            <button type="button" id="btnDateTo" class="btn btn-secondary" style="padding: 0 10px;">üìÖ</button>
        </div>
    </div>
    
    <button type="button" class="settings-toggle" id="settingsToggle">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–Ω–∞–ª–∏–∑–∞</button>
    
    <div id="settingsPanel" class="settings-panel">
        <div class="control-group">
            <label title="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –∑–∞–ø—Ä–∞–≤–∫–∏">–ú–∏–Ω. –∑–∞–ø—Ä–∞–≤–∫–∞ (–ª)</label>
            <input type="number" id="minRefuel" value="10">
        </div>
        <div class="control-group">
            <label title="–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–±—ä–µ–º –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ —Å–ª–∏–≤–∞">–ú–∏–Ω. —Å–ª–∏–≤ (–ª)</label>
            <input type="number" id="minDrain" value="10">
        </div>
        <div class="control-group">
            <label title="–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–∞—Å—Ö–æ–¥ (–ª/—á–∞—Å) –¥–ª—è –æ—Ç—Å–µ–∏–≤–∞–Ω–∏—è —Å–ª–∏–≤–æ–≤">–ú–∞–∫—Å. —Ä–∞—Å—Ö–æ–¥ (–ª/—á)</label>
            <input type="number" id="maxConsumptionPerHour" value="30">
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="filterZeros" checked> –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω—É–ª–∏
            </label>
        </div>
        <div class="control-group">
            <label>
                <input type="checkbox" id="useIgnitionLogic" checked> –£—á–∏—Ç—ã–≤–∞—Ç—å –¥–≤–∏–∂–µ–Ω–∏–µ (—Å–∫–æ—Ä–æ—Å—Ç—å)
            </label>
        </div>
    </div>
    
    <button id="loadBtn" class="btn" disabled>–ó–∞–≥—Ä—É–∑–∏—Ç—å –æ—Ç—á–µ—Ç</button>
</div>

<div class="main-content">
    <!-- Chart -->
    <div class="card">
        <h3 id="chartTitle">–ì—Ä–∞—Ñ–∏–∫</h3>
        <div class="chart-container">
            <canvas id="fuelChart"></canvas>
        </div>
        <div style="text-align: center; font-size: 0.8rem; color: #666; margin-top: 5px;">
            –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–ª–µ—Å–∏–∫–æ –º—ã—à–∏ –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è, –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º–∏—Ä–æ–≤–∞–Ω–∏—è. –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è —Å–±—Ä–æ—Å–∞.
        </div>
    </div>
    
    <!-- Map -->
    <div class="card">
        <h3>–ö–∞—Ä—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–∞ –∏ —Å–æ–±—ã—Ç–∏–π</h3>
        <div id="map" class="map-container"></div>
        <div id="hoverInfo" style="height: 20px; margin-top: 5px; font-size: 0.9rem; color: #333;">
            –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏...
        </div>
    </div>
    
    <!-- Events -->
    <div class="card">
        <h3>–ó–∞–ø—Ä–∞–≤–∫–∏ –∏ —Å–ª–∏–≤—ã</h3>
        <div style="overflow-x: auto;">
            <table id="eventsTable">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞/–≤—Ä–µ–º—è</th>
                        <th>–¢–∏–ø</th>
                        <th>–û–±—ä–µ–º, –ª</th>
                        <th>–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã / –ê–¥—Ä–µ—Å</th>
                        <th>–ö–∞—Ä—Ç–∞</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="5" style="text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Tank Summary -->
    <div class="card">
        <h3>–°–≤–æ–¥–∫–∞ –ø–æ –±–∞–∫–∞–º</h3>
        <div style="overflow-x: auto;">
            <table id="tankSummaryTable" class="report-table">
                <thead>
                    <tr>
                        <th rowspan="2">–ë–∞–∫–∏</th>
                        <th rowspan="2">–ù–∞—á–∞–ª–æ, –ª</th>
                        <th colspan="2">–ó–∞–ø—Ä–∞–≤–∫–∏</th>
                        <th colspan="2">–°–ª–∏–≤—ã</th>
                        <th rowspan="2">–ö–æ–Ω–µ—Ü, –ª</th>
                        <th rowspan="2">–†–∞—Å—Ö–æ–¥, –ª</th>
                        <th rowspan="2">–ü—Ä–æ–±–µ–≥, –∫–º</th>
                        <th rowspan="2">–ú–æ—Ç–æ—á–∞—Å—ã</th>
                        <th rowspan="2">–°—Ä. —Ä–∞—Å—Ö–æ–¥, –ª/100–∫–º</th>
                    </tr>
                    <tr>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th>–û–±—ä–µ–º, –ª</th>
                        <th>–ö–æ–ª-–≤–æ</th>
                        <th>–û–±—ä–µ–º, –ª</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="11" style="text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- Daily Table -->
    <div class="card">
        <h3>–°—É—Ç–æ—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞</h3>
        <div style="overflow-x: auto;">
            <table id="dailyTable" class="report-table">
                <thead>
                    <tr>
                        <th>–î–µ–Ω—å</th>
                        <th>–ù–∞—á–∞–ª–æ, –ª</th>
                        <th>–ö–æ–Ω–µ—Ü, –ª</th>
                        <th>–ó–∞–ø—Ä–∞–≤–∫–∏, –ª</th>
                        <th>–°–ª–∏–≤—ã, –ª</th>
                        <th>–†–∞—Å—Ö–æ–¥, –ª</th>
                        <th>–ü—Ä–æ–±–µ–≥, –∫–º</th>
                        <th>–ú–æ—Ç–æ—á–∞—Å—ã</th>
                        <th>–°—Ä. —Ä–∞—Å—Ö–æ–¥</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td colspan="9" style="text-align:center">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <!-- Old Summary Container (Hidden or Removed, replacing with new tables) -->
    <!-- <div class="card" style="display:none">
        <h3>–°–≤–æ–¥–∫–∞ (Legacy)</h3>
        <div id="summaryContainer">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>
    </div> -->
</div>

<script src="js/config.js"></script>
<script src="js/state.js"></script>
<script src="js/utils.js"></script>
<script src="js/ui.js"></script>
<script src="js/map.js"></script>
<script src="js/chart.js"></script>
<script src="js/analytics.js"></script>
<script src="js/api.js"></script>
<script src="js/vehicle_select.js"></script>
<script src="js/main.js"></script>

<!-- Vehicle Select Overlay -->
<div id="vehicleOverlay" class="vehicle-overlay" style="display: none;">
    <div class="vehicle-overlay-content">
        <div class="vehicle-overlay-header">
            <h2 class="vehicle-overlay-title">–°–ø–∏—Å–æ–∫ –¢–°</h2>
            <button id="closeVehicleOverlayBtn" class="btn btn-danger" style="width: auto;">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
        
        <div class="vehicle-overlay-toolbar">
            <input id="vehicleSearchInput" type="text" placeholder="–ü–æ–∏—Å–∫..." class="vehicle-search-input" />
            <button id="vehicleResetFilters" class="btn btn-secondary" style="width: auto;">–°–±—Ä–æ—Å</button>
        </div>
    
        <div class="vehicle-overlay-body">
            <table class="vehicle-table">
                <thead>
                    <tr>
                        <th data-sort="id">ID</th>
                        <th data-sort="number">–ò–º—è</th>
                        <th data-sort="fleet">–ì—Ä—É–ø–ø–∞</th>
                    </tr>
                </thead>
                <tbody id="vehicleTableBody">
                    <!-- Rows via JS -->
                </tbody>
            </table>
        </div>
    </div>
</div>

</body>
</html>
